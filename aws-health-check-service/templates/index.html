<!DOCTYPE html>
<html>
<head>
    <title>AWS Component Health Check</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .step { margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f4f4f4; padding: 10px; }
    </style>
</head>
<body>

<h2>AWS YAML Health Check</h2>

<input type="file" id="fileInput" accept=".yml,.yaml" />
<br><br>
<button id="uploadBtn" type="button">Upload & Validate</button>

<div id="status"></div>
<pre id="result"></pre>

<script>
document.getElementById("uploadBtn").addEventListener("click", async function () {

    const fileInput = document.getElementById("fileInput");
    const statusDiv = document.getElementById("status");
    const resultDiv = document.getElementById("result");

    if (!fileInput.files.length) {
        statusDiv.innerHTML = <div class="error">Please select a YAML file</div>;
        return;
    }

    statusDiv.innerHTML = "Processing...";
    resultDiv.textContent = "";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    try {
        const response = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            throw new Error("Upload failed");
        }

        const data = await response.json();

        let statusHtml = "";
        data.steps.forEach(step => {
            statusHtml += <div class="step ${step.status}">${step.message}</div>;
        });

        statusDiv.innerHTML = statusHtml;
        resultDiv.textContent = JSON.stringify(data.health_report, null, 2);

    } catch (err) {
        statusDiv.innerHTML = <div class="error">${err.message}</div>;
    }
});
</script>

</body>
</html>