<!DOCTYPE html>
<html>
<head>
    <title>AWS Compotant Health Check</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .step { margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f4f4f4; padding: 10px; }
    </style>
</head>
<body>

<h2>AWS YAML Health Check</h2>

<form id="uploadForm" action="javascript:void(0);" enctype="multipart/form-data">
    <input type="file" name="file" accept=".yml,.yaml" required />
    <br><br>
    <button type="submit">Upload & Validate</button>
</form>

<div id="status"></div>
<pre id="result"></pre>

<script>
document.getElementById("uploadForm").addEventListener("submit", async function (e) {
    e.preventDefault();   // â›” stop browser redirect

    const statusDiv = document.getElementById("status");
    const resultDiv = document.getElementById("result");

    statusDiv.innerHTML = "Processing...";
    resultDiv.textContent = "";

    try {
        const formData = new FormData(this);

        const response = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            throw new Error("Upload failed");
        }

        const data = await response.json();

        let statusHtml = "";
        data.steps.forEach(step => {
            statusHtml += <div class="step ${step.status}">${step.message}</div>;
        });

        statusDiv.innerHTML = statusHtml;
        resultDiv.textContent = JSON.stringify(data.health_report, null, 2);

    } catch (err) {
        statusDiv.innerHTML = <div class="error">Error: ${err.message}</div>;
    }
});
</script>


</body>
</html>